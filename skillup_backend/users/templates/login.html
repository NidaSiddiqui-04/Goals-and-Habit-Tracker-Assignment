{%extends 'base.html'%}
{%block content%}

<div class="container my-5" >
    <div class="row ">
       <div class="col-sm-7"> 
          <h3><img src="https://img.icons8.com/?size=160&id=vzCFrqU96tpa&format=png" style="width: 80px;" >  Goal Tracker</h3>
          <div class="my-3">
            <h5 class="my-4">Achieve Your Goals</h5>
            <p>Track your progress, build better habits, and accomplish your dreams with our intuitive goal tracking platform.</p>
      
          </div>
          <div class="mt-4">
            
              <p><img src="https://img.icons8.com/?size=160&id=64704&format=png" style="width: 50px;" >Set Clear Goals<br/> <span class="ps-5">Define your objectives and break them down into actionable steps</span></p>
            
              <p><img src="https://img.icons8.com/?size=96&id=12814&format=png" style="width: 50px;" >Track Progress<br/> <span class="ps-5">Monitor your achievements with visual progress indicators</span></p>
              <p><img src="https://img.icons8.com/?size=160&id=IvKTbJEwgLtS&format=png" style="width: 50px;" >Stay Motivated<br/> <span class="ps-5">Celebrate milestones and maintain momentum</span></p>

          </div>
       </div>
    

    <div class="col-sm-5 mt-4 " style="width: 28rem;">
      <div class="row ">
        <div class="shadow-lg p-3 mb-5 bg-body rounded">

     <div class="p-3">
    <div id="msg"></div>
    <h2 class="text-center ">Login</h2>
      <form id="loginForm" method="post">
        <div class="col my-3">
            <label for="username" class="fw-bold ">Username:</label>
            <input type="text" name="username" id="username" placeholder="Username" class="form-control rounded" required>
        </div>
        <div class="col mb-3">
            <label for="password" class="fw-bold ">Password</label>
            <input type="password" name="password" id="password" class="form-control" required>
        </div>
        <div class="col mb-3">
                    <button type="submit" id="login" style="width: 100%;" class="btn btn-outline-primary ">Login</button>

        </div>
        <div class="col  text-center">
            <p>Don't have an account? <a href="{%url 'register-page'%}">Create</a></p>
        </div>
      </form>
        </span>
    </div></div>
    </div>
    </div>
    </div>
</div>





 

{%endblock%}

{%block scripts%}
<script>
    


const form = document.getElementById('loginForm');
const msg  = document.getElementById('msg');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  msg.textContent = '';
  msg.className   = ' <button type="submit"  style="width: 100%;" class="btn btn-outline-primary disabled">Login</button>'
  
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  if(username==''&&password==''){
    const btn=document.getElementById('login')
    btn='';
    btn=``
  }
  
  if (!username || !password) {
    msg.textContent = 'Username and password are required.';
    msg.className   = 'error';
    return;
  }

  try {
    const res = await fetch('/api/auth/login/', {
      method: 'POST',
      
      headers: {
        'Content-Type': 'application/json',
         // if you’re using CSRF
      },
      
      body: JSON.stringify({username,password})
     

    });

       const data = await res.json();

    

    if (!res.ok) {
      // show error message
      msg.textContent = data.detail || 'Login failed. Please check credentials.';
      msg.className   = 'error';
      return;
    }
  

   


    // On success you’ll get something like: { access: "...", refresh: "..." }
    const accessToken  = data.access;
    const refreshToken = data.refresh;
    
    // Store them (localStorage, sessionStorage, or cookie depending on your security model)
    localStorage.setItem('accessToken', accessToken);
    localStorage.setItem('refreshToken', refreshToken);
    console.log(data.username)
    console.log(localStorage.getItem('accessToken'))
    if (res.ok && data.access) {
    // Redirect to dashboard or whatever page you want
    window.location.href = '/dashboard/';
    }
  } catch (err) {
    console.error('Login fetch error:', err);
     msg.innerHTML = '<p class="alert alert-danger" role="alert">An error occurred. Try again later</p>';
  }
});
</script>
{%endblock scripts%}